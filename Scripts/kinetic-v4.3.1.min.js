var Kinetic={};(function(){Kinetic.version="4.3.1",Kinetic.Filters={},Kinetic.Plugins={},Kinetic.Global={stages:[],idCounter:0,ids:{},names:{},shapes:{},warn:function(n){window.console&&console.warn&&console.warn("Kinetic warning: "+n)},extend:function(n,t){for(var i in t.prototype)i in n.prototype||(n.prototype[i]=t.prototype[i])},_addId:function(n,t){t!==undefined&&(this.ids[t]=n)},_removeId:function(n){n!==undefined&&delete this.ids[n]},_addName:function(n,t){t!==undefined&&(this.names[t]===undefined&&(this.names[t]=[]),this.names[t].push(n))},_removeName:function(n,t){var i,r,u;if(n!==undefined&&(i=this.names[n],i!==undefined)){for(r=0;r<i.length;r++)u=i[r],u._id===t&&i.splice(r,1);i.length===0&&delete this.names[n]}}}})(),function(n,t){typeof exports=="object"?module.exports=t():typeof define=="function"&&define.amd?define(t):n.returnExports=t()}(this,function(){return Kinetic}),function(){Kinetic.Type={_isElement:function(n){return!!(n&&n.nodeType==1)},_isFunction:function(n){return!!(n&&n.constructor&&n.call&&n.apply)},_isObject:function(n){return!!n&&n.constructor==Object},_isArray:function(n){return Object.prototype.toString.call(n)=="[object Array]"},_isNumber:function(n){return Object.prototype.toString.call(n)=="[object Number]"},_isString:function(n){return Object.prototype.toString.call(n)=="[object String]"},_hasMethods:function(n){var i=[],t;for(t in n)this._isFunction(n[t])&&i.push(t);return i.length>0},_isInDocument:function(n){while(n=n.parentNode)if(n==document)return!0;return!1},_getXY:function(n){if(this._isNumber(n))return{x:n,y:n};if(this._isArray(n)){if(n.length===1){var t=n[0];if(this._isNumber(t))return{x:t,y:t};if(this._isArray(t))return{x:t[0],y:t[1]};if(this._isObject(t))return t}else if(n.length>=2)return{x:n[0],y:n[1]}}else if(this._isObject(n))return n;return null},_getSize:function(n){if(this._isNumber(n))return{width:n,height:n};if(this._isArray(n))if(n.length===1){var t=n[0];if(this._isNumber(t))return{width:t,height:t};if(this._isArray(t)){if(t.length>=4)return{width:t[2],height:t[3]};if(t.length>=2)return{width:t[0],height:t[1]}}else if(this._isObject(t))return t}else{if(n.length>=4)return{width:n[2],height:n[3]};if(n.length>=2)return{width:n[0],height:n[1]}}else if(this._isObject(n))return n;return null},_getPoints:function(n){var i,t;if(n===undefined)return[];if(this._isArray(n[0])){for(i=[],t=0;t<n.length;t++)i.push({x:n[t][0],y:n[t][1]});return i}if(this._isObject(n[0]))return n;for(i=[],t=0;t<n.length;t+=2)i.push({x:n[t],y:n[t+1]});return i},_getImage:function(n,t){var r,u,f,i;n?this._isElement(n)?t(n):this._isString(n)?(i=new Image,i.onload=function(){t(i)},i.src=n):n.data?(r=document.createElement("canvas"),r.width=n.width,r.height=n.height,u=r.getContext("2d"),u.putImageData(n,0,0),f=r.toDataURL(),i=new Image,i.onload=function(){t(i)},i.src=f):t(null):t(null)},_rgbToHex:function(n,t,i){return(16777216+(n<<16)+(t<<8)+i).toString(16).slice(1)},_hexToRgb:function(n){var t=parseInt(n,16);return{r:t>>16&255,g:t>>8&255,b:t&255}},_getRandomColorKey:function(){var n=Math.round(Math.random()*255),t=Math.round(Math.random()*255),i=Math.round(Math.random()*255);return this._rgbToHex(n,t,i)},_merge:function(n,t){var r=this._clone(t),i;for(i in n)r[i]=this._isObject(n[i])?this._merge(n[i],r[i]):n[i];return r},_clone:function(n){var i={},t;for(t in n)i[t]=this._isObject(n[t])?this._clone(n[t]):n[t];return i},_degToRad:function(n){return n*Math.PI/180},_radToDeg:function(n){return n*180/Math.PI}}}(),function(){Kinetic.Canvas=function(n,t){this.width=n,this.height=t,this.element=document.createElement("canvas"),this.context=this.element.getContext("2d"),this.setSize(n||0,t||0)};var t=document.createElement("canvas"),n=t.getContext("2d"),i=window.devicePixelRatio||1,r=n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1;Kinetic.Canvas.pixelRatio=i/r,Kinetic.Canvas.prototype={clear:function(){var t=this.getContext(),n=this.getElement();t.clearRect(0,0,n.width,n.height)},getElement:function(){return this.element},getContext:function(){return this.context},setWidth:function(n){this.width=n,this.element.width=n*Kinetic.Canvas.pixelRatio,this.element.style.width=n+"px"},setHeight:function(n){this.height=n,this.element.height=n*Kinetic.Canvas.pixelRatio,this.element.style.height=n+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(n,t){this.setWidth(n),this.setHeight(t)},toDataURL:function(n,t){try{return this.element.toDataURL(n,t)}catch(i){try{return this.element.toDataURL()}catch(i){return Kinetic.Global.warn("Unable to get data URL. "+i.message),""}}},fill:function(n){this._fill(n)},stroke:function(n){this._stroke(n)},fillStroke:function(n){this._fill(n),this._stroke(n,n.hasShadow()&&n.getFill())},applyShadow:function(n,t){var i=this.context;i.save(),this._applyShadow(n),t(),i.restore(),t()},_applyLineCap:function(n){var t=n.getLineCap();t&&(this.context.lineCap=t)},_applyOpacity:function(n){var t=n.getAbsoluteOpacity();t!==1&&(this.context.globalAlpha=t)},_applyLineJoin:function(n){var t=n.getLineJoin();t&&(this.context.lineJoin=t)},_handlePixelRatio:function(){var n=Kinetic.Canvas.pixelRatio;n!==1&&this.getContext().scale(n,n)},_counterPixelRatio:function(){var n=Kinetic.Canvas.pixelRatio;n!==1&&(n=1/n,this.getContext().scale(n,n))},_applyAncestorTransforms:function(n){var t=this.context;n._eachAncestorReverse(function(n){var r=n.getTransform(),i=r.getMatrix();t.transform(i[0],i[1],i[2],i[3],i[4],i[5])},!0)}},Kinetic.SceneCanvas=function(n,t){Kinetic.Canvas.call(this,n,t)},Kinetic.SceneCanvas.prototype={_fillColor:function(n){var t=this.context,i=n.getFill();t.fillStyle=i,t.fill(t)},_fillPattern:function(n){var t=this.context,o=n.getFillPatternImage(),u=n.getFillPatternX(),f=n.getFillPatternY(),i=n.getFillPatternScale(),e=n.getFillPatternRotation(),r=n.getFillPatternOffset(),s=n.getFillPatternRepeat();(u||f)&&t.translate(u||0,f||0),e&&t.rotate(e),i&&t.scale(i.x,i.y),r&&t.translate(-1*r.x,-1*r.y),t.fillStyle=t.createPattern(o,s||"repeat"),t.fill(t)},_fillLinearGradient:function(n){for(var i=this.context,u=n.getFillLinearGradientStartPoint(),f=n.getFillLinearGradientEndPoint(),r=n.getFillLinearGradientColorStops(),e=i.createLinearGradient(u.x,u.y,f.x,f.y),t=0;t<r.length;t+=2)e.addColorStop(r[t],r[t+1]);i.fillStyle=e,i.fill(i)},_fillRadialGradient:function(n){for(var i=this.context,u=n.getFillRadialGradientStartPoint(),f=n.getFillRadialGradientEndPoint(),o=n.getFillRadialGradientStartRadius(),s=n.getFillRadialGradientEndRadius(),r=n.getFillRadialGradientColorStops(),e=i.createRadialGradient(u.x,u.y,o,f.x,f.y,s),t=0;t<r.length;t+=2)e.addColorStop(r[t],r[t+1]);i.fillStyle=e,i.fill(i)},_fill:function(n,t){var i=this.context,r=n.getFill(),u=n.getFillPatternImage(),f=n.getFillLinearGradientStartPoint(),e=n.getFillRadialGradientStartPoint();i.save(),!t&&n.hasShadow()&&this._applyShadow(n),r?this._fillColor(n):u?this._fillPattern(n):f?this._fillLinearGradient(n):e&&this._fillRadialGradient(n),i.restore(),!t&&n.hasShadow()&&this._fill(n,!0)},_stroke:function(n,t){var i=this.context,r=n.getStroke(),u=n.getStrokeWidth(),f=n.getDashArray();(r||u)&&(i.save(),this._applyLineCap(n),f&&i.setLineDash&&i.setLineDash(f),!t&&n.hasShadow()&&this._applyShadow(n),i.lineWidth=u||2,i.strokeStyle=r||"black",i.stroke(i),i.restore(),!t&&n.hasShadow()&&this._stroke(n,!0))},_applyShadow:function(n){var t=this.context;if(n.hasShadow()){var r=n.getAbsoluteOpacity(),u=n.getShadowColor()||"black",f=n.getShadowBlur()||5,i=n.getShadowOffset()||{x:0,y:0};n.getShadowOpacity()&&(t.globalAlpha=n.getShadowOpacity()*r),t.shadowColor=u,t.shadowBlur=f,t.shadowOffsetX=i.x,t.shadowOffsetY=i.y}}},Kinetic.Global.extend(Kinetic.SceneCanvas,Kinetic.Canvas),Kinetic.HitCanvas=function(n,t){Kinetic.Canvas.call(this,n,t)},Kinetic.HitCanvas.prototype={_fill:function(n){var t=this.context;t.save(),t.fillStyle="#"+n.colorKey,t.fill(t),t.restore()},_stroke:function(n){var t=this.context,r=n.getStroke(),i=n.getStrokeWidth();(r||i)&&(this._applyLineCap(n),t.save(),t.lineWidth=i||2,t.strokeStyle="#"+n.colorKey,t.stroke(t),t.restore())}},Kinetic.Global.extend(Kinetic.HitCanvas,Kinetic.Canvas)}(),function(){Kinetic.Tween=function(n,t,i,r,u,f){this._listeners=[],this.addListener(this),this.obj=n,this.propFunc=t,this.begin=r,this._pos=r,this.setDuration(f),this.isPlaying=!1,this._change=0,this.prevTime=0,this.prevPos=0,this.looping=!1,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.name="",this.func=i,this.setFinish(u)},Kinetic.Tween.prototype={setTime:function(n){this.prevTime=this._time,n>this.getDuration()?this.looping?(this.rewind(n-this._duration),this.update(),this.broadcastMessage("onLooped",{target:this,type:"onLooped"})):(this._time=this._duration,this.update(),this.stop(),this.broadcastMessage("onFinished",{target:this,type:"onFinished"})):n<0?(this.rewind(),this.update()):(this._time=n,this.update())},getTime:function(){return this._time},setDuration:function(n){this._duration=n===null||n<=0?1e5:n},getDuration:function(){return this._duration},setPosition:function(n){this.prevPos=this._pos,this.propFunc(n),this._pos=n,this.broadcastMessage("onChanged",{target:this,type:"onChanged"})},getPosition:function(n){return n===undefined&&(n=this._time),this.func(n,this.begin,this._change,this._duration)},setFinish:function(n){this._change=n-this.begin},getFinish:function(){return this.begin+this._change},start:function(){this.rewind(),this.startEnterFrame(),this.broadcastMessage("onStarted",{target:this,type:"onStarted"})},rewind:function(n){this.stop(),this._time=n===undefined?0:n,this.fixTime(),this.update()},fforward:function(){this._time=this._duration,this.fixTime(),this.update()},update:function(){this.setPosition(this.getPosition(this._time))},startEnterFrame:function(){this.stopEnterFrame(),this.isPlaying=!0,this.onEnterFrame()},onEnterFrame:function(){this.isPlaying&&this.nextFrame()},nextFrame:function(){this.setTime((this.getTimer()-this._startTime)/1e3)},stop:function(){this.stopEnterFrame(),this.broadcastMessage("onStopped",{target:this,type:"onStopped"})},stopEnterFrame:function(){this.isPlaying=!1},continueTo:function(n,t){this.begin=this._pos,this.setFinish(n),this._duration!==undefined&&this.setDuration(t),this.start()},resume:function(){this.fixTime(),this.startEnterFrame(),this.broadcastMessage("onResumed",{target:this,type:"onResumed"})},yoyo:function(){this.continueTo(this.begin,this._time)},addListener:function(n){return this.removeListener(n),this._listeners.push(n)},removeListener:function(n){for(var t=this._listeners,i=t.length;i--;)if(t[i]==n)return t.splice(i,1),!0;return!1},broadcastMessage:function(){for(var i=[],n=0;n<arguments.length;n++)i.push(arguments[n]);var r=i.shift(),t=this._listeners,u=t.length;for(n=0;n<u;n++)t[n][r]&&t[n][r].apply(t[n],i)},fixTime:function(){this._startTime=this.getTimer()-this._time*1e3},getTimer:function(){return(new Date).getTime()-this._time}},Kinetic.Tweens={"back-ease-in":function(n,t,i,r){var u=1.70158;return i*(n/=r)*n*((u+1)*n-u)+t},"back-ease-out":function(n,t,i,r){var u=1.70158;return i*((n=n/r-1)*n*((u+1)*n+u)+1)+t},"back-ease-in-out":function(n,t,i,r){var u=1.70158;return(n/=r/2)<1?i/2*n*n*(((u*=1.525)+1)*n-u)+t:i/2*((n-=2)*n*(((u*=1.525)+1)*n+u)+2)+t},"elastic-ease-in":function(n,t,i,r,u,f){var e=0;return n===0?t:(n/=r)==1?t+i:(f||(f=r*.3),!u||u<Math.abs(i)?(u=i,e=f/4):e=f/(2*Math.PI)*Math.asin(i/u),-(u*Math.pow(2,10*(n-=1))*Math.sin((n*r-e)*2*Math.PI/f))+t)},"elastic-ease-out":function(n,t,i,r,u,f){var e=0;return n===0?t:(n/=r)==1?t+i:(f||(f=r*.3),!u||u<Math.abs(i)?(u=i,e=f/4):e=f/(2*Math.PI)*Math.asin(i/u),u*Math.pow(2,-10*n)*Math.sin((n*r-e)*2*Math.PI/f)+i+t)},"elastic-ease-in-out":function(n,t,i,r,u,f){var e=0;return n===0?t:(n/=r/2)==2?t+i:(f||(f=r*.3*1.5),!u||u<Math.abs(i)?(u=i,e=f/4):e=f/(2*Math.PI)*Math.asin(i/u),n<1)?-.5*u*Math.pow(2,10*(n-=1))*Math.sin((n*r-e)*2*Math.PI/f)+t:u*Math.pow(2,-10*(n-=1))*Math.sin((n*r-e)*2*Math.PI/f)*.5+i+t},"bounce-ease-out":function(n,t,i,r){return(n/=r)<1/2.75?i*7.5625*n*n+t:n<2/2.75?i*(7.5625*(n-=1.5/2.75)*n+.75)+t:n<2.5/2.75?i*(7.5625*(n-=2.25/2.75)*n+.9375)+t:i*(7.5625*(n-=2.625/2.75)*n+.984375)+t},"bounce-ease-in":function(n,t,i,r){return i-Kinetic.Tweens["bounce-ease-out"](r-n,0,i,r)+t},"bounce-ease-in-out":function(n,t,i,r){return n<r/2?Kinetic.Tweens["bounce-ease-in"](n*2,0,i,r)*.5+t:Kinetic.Tweens["bounce-ease-out"](n*2-r,0,i,r)*.5+i*.5+t},"ease-in":function(n,t,i,r){return i*(n/=r)*n+t},"ease-out":function(n,t,i,r){return-i*(n/=r)*(n-2)+t},"ease-in-out":function(n,t,i,r){return(n/=r/2)<1?i/2*n*n+t:-i/2*(--n*(n-2)-1)+t},"strong-ease-in":function(n,t,i,r){return i*(n/=r)*n*n*n*n+t},"strong-ease-out":function(n,t,i,r){return i*((n=n/r-1)*n*n*n*n+1)+t},"strong-ease-in-out":function(n,t,i,r){return(n/=r/2)<1?i/2*n*n*n*n*n+t:i/2*((n-=2)*n*n*n*n+2)+t},linear:function(n,t,i,r){return i*n/r+t}}}(),function(){Kinetic.Transform=function(){this.m=[1,0,0,1,0,0]},Kinetic.Transform.prototype={translate:function(n,t){this.m[4]+=this.m[0]*n+this.m[2]*t,this.m[5]+=this.m[1]*n+this.m[3]*t},scale:function(n,t){this.m[0]*=n,this.m[1]*=n,this.m[2]*=t,this.m[3]*=t},rotate:function(n){var t=Math.cos(n),i=Math.sin(n),r=this.m[0]*t+this.m[2]*i,u=this.m[1]*t+this.m[3]*i,f=this.m[0]*-i+this.m[2]*t,e=this.m[1]*-i+this.m[3]*t;this.m[0]=r,this.m[1]=u,this.m[2]=f,this.m[3]=e},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},multiply:function(n){var t=this.m[0]*n.m[0]+this.m[2]*n.m[1],i=this.m[1]*n.m[0]+this.m[3]*n.m[1],r=this.m[0]*n.m[2]+this.m[2]*n.m[3],u=this.m[1]*n.m[2]+this.m[3]*n.m[3],f=this.m[0]*n.m[4]+this.m[2]*n.m[5]+this.m[4],e=this.m[1]*n.m[4]+this.m[3]*n.m[5]+this.m[5];this.m[0]=t,this.m[1]=i,this.m[2]=r,this.m[3]=u,this.m[4]=f,this.m[5]=e},invert:function(){var n=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*n,i=-this.m[1]*n,r=-this.m[2]*n,u=this.m[0]*n,f=n*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),e=n*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=t,this.m[1]=i,this.m[2]=r,this.m[3]=u,this.m[4]=f,this.m[5]=e},getMatrix:function(){return this.m}}}(),function(){Kinetic.Collection=function(){var t=[].slice.call(arguments),i=t.length,n=0;for(this.length=i;n<i;n++)this[n]=t[n];return this},Kinetic.Collection.prototype=[],Kinetic.Collection.prototype.apply=function(n){args=[].slice.call(arguments),args.shift();for(var t=0;t<this.length;t++)Kinetic.Type._isFunction(this[t][n])&&this[t][n].apply(this[t],args)},Kinetic.Collection.prototype.each=function(n){for(var t=0;t<this.length;t++)n.call(this[t],t,this[t])}}(),function(){Kinetic.Filters.Grayscale=function(n){for(var i=n.data,r,t=0;t<i.length;t+=4)r=.34*i[t]+.5*i[t+1]+.16*i[t+2],i[t]=r,i[t+1]=r,i[t+2]=r}}(),function(){Kinetic.Filters.Brighten=function(n,t){for(var u=t.val||0,r=n.data,i=0;i<r.length;i+=4)r[i]+=u,r[i+1]+=u,r[i+2]+=u}}(),function(){Kinetic.Filters.Invert=function(n){for(var i=n.data,t=0;t<i.length;t+=4)i[t]=255-i[t],i[t+1]=255-i[t+1],i[t+2]=255-i[t+2]}}(),function(){Kinetic.Animation=function(n,t){this.func=n,this.node=t,this.id=Kinetic.Animation.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:(new Date).getTime()}},Kinetic.Animation.prototype={isRunning:function(){for(var i=Kinetic.Animation,t=i.animations,n=0;n<t.length;n++)if(t[n].id===this.id)return!0;return!1},start:function(){this.stop(),this.frame.timeDiff=0,this.frame.lastTime=(new Date).getTime(),Kinetic.Animation._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(n){this.frame.timeDiff=n-this.frame.lastTime,this.frame.lastTime=n,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}},Kinetic.Animation.animations=[],Kinetic.Animation.animIdCounter=0,Kinetic.Animation.animRunning=!1,Kinetic.Animation.fixedRequestAnimFrame=function(n){window.setTimeout(n,1e3/60)},Kinetic.Animation._addAnimation=function(n){this.animations.push(n),this._handleAnimation()},Kinetic.Animation._removeAnimation=function(n){for(var r=n.id,i=this.animations,u=i.length,t=0;t<u;t++)if(i[t].id===r){this.animations.splice(t,1);break}},Kinetic.Animation._runFrames=function(){for(var r={},u=this.animations,e,n=0;n<u.length;n++){var t=u[n],i=t.node,f=t.func;t._updateFrameObject((new Date).getTime()),i&&i._id!==undefined&&(r[i._id]=i),f&&f(t.frame)}for(e in r)r[e].draw()},Kinetic.Animation._animationLoop=function(){var n=this;this.animations.length>0?(this._runFrames(),Kinetic.Animation.requestAnimFrame(function(){n._animationLoop()})):this.animRunning=!1},Kinetic.Animation._handleAnimation=function(){var n=this;this.animRunning||(this.animRunning=!0,n._animationLoop())},RAF=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||Kinetic.Animation.fixedRequestAnimFrame}(),Kinetic.Animation.requestAnimFrame=function(n){var t=Kinetic.DD&&Kinetic.DD.moving?this.fixedRequestAnimFrame:RAF;t(n)}}(),function(){var t,n;for(Kinetic.Node=function(n){this._nodeInit(n)},Kinetic.Node.prototype={_nodeInit:function(n){this._id=Kinetic.Global.idCounter++,this.defaultNodeAttrs={visible:!0,listening:!0,name:undefined,opacity:1,x:0,y:0,scale:{x:1,y:1},rotation:0,offset:{x:0,y:0},draggable:!1,dragOnTop:!0},this.setDefaultAttrs(this.defaultNodeAttrs),this.eventListeners={},this.setAttrs(n)},on:function(n,t){for(var f=n.split(" "),e=f.length,i=0;i<e;i++){var o=f[i],s=o,r=s.split("."),u=r[0],h=r.length>1?r[1]:"";this.eventListeners[u]||(this.eventListeners[u]=[]),this.eventListeners[u].push({name:h,handler:t})}},off:function(n){for(var f=n.split(" "),e=f.length,u,t=0;t<e;t++){var u=f[t],o=u,i=o.split("."),r=i[0];if(i.length>1)if(r)this.eventListeners[r]&&this._off(r,i[1]);else for(u in this.eventListeners)this._off(u,i[1]);else delete this.eventListeners[r]}},remove:function(){var n=this.getParent();n&&n.children&&(n.children.splice(this.index,1),n._setChildrenIndices()),delete this.parent},destroy:function(){for(var i=this.getParent(),r=this.getStage(),n=Kinetic.DD,t=Kinetic.Global;this.children&&this.children.length>0;)this.children[0].destroy();t._removeId(this.getId()),t._removeName(this.getName(),this._id),n&&n.node&&n.node._id===this._id&&node._endDrag(),this.trans&&this.trans.stop(),this.remove()},getAttrs:function(){return this.attrs},setDefaultAttrs:function(n){if(this.attrs===undefined&&(this.attrs={}),n)for(var t in n)this.attrs[t]===undefined&&(this.attrs[t]=n[t])},setAttrs:function(n){var t,i;if(n)for(t in n)i="set"+t.charAt(0).toUpperCase()+t.slice(1),Kinetic.Type._isFunction(this[i])?this[i](n[t]):this.setAttr(t,n[t])},getVisible:function(){var n=this.attrs.visible,t=this.getParent();return n&&t&&!t.getVisible()?!1:n},getListening:function(){var n=this.attrs.listening,t=this.getParent();return n&&t&&!t.getListening()?!1:n},show:function(){this.setVisible(!0)},hide:function(){this.setVisible(!1)},getZIndex:function(){return this.index},getAbsoluteZIndex:function(){function i(u){for(var f=[],s=u.length,o,e=0;e<s;e++)o=u[e],t++,o.nodeType!=="Shape"&&(f=f.concat(o.getChildren())),o._id===n._id&&(e=s);f.length>0&&f[0].getLevel()<=r&&i(f)}var r=this.getLevel(),u=this.getStage(),n=this,t=0;return n.nodeType!=="Stage"&&i(n.getStage().getChildren()),t},getLevel:function(){for(var t=0,n=this.parent;n;)t++,n=n.parent;return t},setPosition:function(){var n=Kinetic.Type._getXY([].slice.call(arguments));this.setAttr("x",n.x),this.setAttr("y",n.y)},getPosition:function(){var n=this.attrs;return{x:n.x,y:n.y}},getAbsolutePosition:function(){var n=this.getAbsoluteTransform(),t=this.getOffset();return n.translate(t.x,t.y),n.getTranslation()},setAbsolutePosition:function(){var n=Kinetic.Type._getXY([].slice.call(arguments)),t=this._clearTransform(),i;this.attrs.x=t.x,this.attrs.y=t.y,delete t.x,delete t.y,i=this.getAbsoluteTransform(),i.invert(),i.translate(n.x,n.y),n={x:this.attrs.x+i.getTranslation().x,y:this.attrs.y+i.getTranslation().y},this.setPosition(n.x,n.y),this._setTransform(t)},move:function(){var n=Kinetic.Type._getXY([].slice.call(arguments)),t=this.getX(),i=this.getY();n.x!==undefined&&(t+=n.x),n.y!==undefined&&(i+=n.y),this.setPosition(t,i)},_eachAncestorReverse:function(n,t){var i=[],r=this.getParent(),f,u;for(t&&i.unshift(this);r;)i.unshift(r),r=r.parent;for(f=i.length,u=0;u<f;u++)n(i[u])},rotate:function(n){this.setRotation(this.getRotation()+n)},rotateDeg:function(n){this.setRotation(this.getRotation()+Kinetic.Type._degToRad(n))},moveToTop:function(){var n=this.index;return this.parent.children.splice(n,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},moveUp:function(){var n=this.index,t=this.parent.getChildren().length;if(n<t-1)return this.parent.children.splice(n,1),this.parent.children.splice(n+1,0,this),this.parent._setChildrenIndices(),!0},moveDown:function(){var n=this.index;if(n>0)return this.parent.children.splice(n,1),this.parent.children.splice(n-1,0,this),this.parent._setChildrenIndices(),!0},moveToBottom:function(){var n=this.index;if(n>0)return this.parent.children.splice(n,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0},setZIndex:function(n){var t=this.index;this.parent.children.splice(t,1),this.parent.children.splice(n,0,this),this.parent._setChildrenIndices()},getAbsoluteOpacity:function(){var n=this.getOpacity();return this.getParent()&&(n*=this.getParent().getAbsoluteOpacity()),n},moveTo:function(n){Kinetic.Node.prototype.remove.call(this),n.add(this)},toObject:function(){var i=Kinetic.Type,t={},u=this.attrs,r,n;t.attrs={};for(r in u)n=u[r],i._isFunction(n)||i._isElement(n)||i._isObject(n)&&i._hasMethods(n)||(t.attrs[r]=n);return t.nodeType=this.nodeType,t.shapeType=this.shapeType,t},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){return this.getParent().getLayer()},getStage:function(){return this.getParent()?this.getParent().getStage():undefined},simulate:function(n,t){this._handleEvent(n,t||{})},fire:function(n,t){this._executeHandlers(n,t||{})},getAbsoluteTransform:function(){var n=new Kinetic.Transform;return this._eachAncestorReverse(function(t){var i=t.getTransform();n.multiply(i)},!0),n},getTransform:function(){var n=new Kinetic.Transform,t=this.attrs,i=t.x,r=t.y,u=t.rotation,f=t.scale,e=f.x,o=f.y,s=t.offset,h=s.x,c=s.y;return(i!==0||r!==0)&&n.translate(i,r),u!==0&&n.rotate(u),(e!==1||o!==1)&&n.scale(e,o),(h!==0||c!==0)&&n.translate(-1*h,-1*c),n},clone:function(n){var o=this.shapeType||this.nodeType,t=new Kinetic[o](this.attrs),i,u,e,r,f;for(i in this.eventListeners)for(u=this.eventListeners[i],e=u.length,r=0;r<e;r++)f=u[r],f.name.indexOf("kinetic")<0&&(t.eventListeners[i]||(t.eventListeners[i]=[]),t.eventListeners[i].push(f));return t.setAttrs(n),t},toDataURL:function(n){n=n||{};var f=n.mimeType||null,e=n.quality||null,t,i,r=n.x||0,u=n.y||0;return n.width&&n.height?t=new Kinetic.SceneCanvas(n.width,n.height):(t=this.getStage().bufferCanvas,t.clear()),i=t.getContext(),i.save(),t._counterPixelRatio(),(r||u)&&i.translate(-1*r,-1*u),this.drawScene(t),i.restore(),t.toDataURL(f,e)},toImage:function(n){Kinetic.Type._getImage(this.toDataURL(n),function(t){n.callback(t)})},setSize:function(){var n=Kinetic.Type._getSize(Array.prototype.slice.call(arguments));this.setWidth(n.width),this.setHeight(n.height)},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},_get:function(n){return this.nodeType===n?[this]:[]},_off:function(n,t){for(var i=0;i<this.eventListeners[n].length;i++)if(this.eventListeners[n][i].name===t){if(this.eventListeners[n].splice(i,1),this.eventListeners[n].length===0){delete this.eventListeners[n];break}i--}},_clearTransform:function(){var n=this.attrs,t=n.scale,i=n.offset,r={x:n.x,y:n.y,rotation:n.rotation,scale:{x:t.x,y:t.y},offset:{x:i.x,y:i.y}};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scale={x:1,y:1},this.attrs.offset={x:0,y:0},r},_setTransform:function(n){for(var t in n)this.attrs[t]=n[t]},_fireBeforeChangeEvent:function(n,t,i){this._handleEvent("before"+n.toUpperCase()+"Change",{oldVal:t,newVal:i})},_fireChangeEvent:function(n,t,i){this._handleEvent(n+"Change",{oldVal:t,newVal:i})},setId:function(n){var i=this.getId(),r=this.getStage(),t=Kinetic.Global;t._removeId(i),t._addId(this,n),this.setAttr("id",n)},setName:function(n){var i=this.getName(),r=this.getStage(),t=Kinetic.Global;t._removeName(i,this._id),t._addName(this,n),this.setAttr("name",n)},setAttr:function(n,t){if(t!==undefined){var i=this.attrs[n];this._fireBeforeChangeEvent(n,i,t),this.attrs[n]=t,this._fireChangeEvent(n,i,t)}},_handleEvent:function(n,t,i){t&&this.nodeType==="Shape"&&(t.shape=this);var f=this.getStage(),u=this.eventListeners,r=!0;n==="mouseenter"&&i&&this._id===i._id?r=!1:n==="mouseleave"&&i&&this._id===i._id&&(r=!1),r&&(u[n]&&this.fire(n,t),t&&!t.cancelBubble&&this.parent&&(i&&i.parent?this._handleEvent.call(this.parent,n,t,i.parent):this._handleEvent.call(this.parent,n,t)))},_executeHandlers:function(n,t){for(var r=this.eventListeners[n],u=r.length,i=0;i<u;i++)r[i].handler.apply(this,[t])}},Kinetic.Node.addSetters=function(n,t){for(var u=t.length,r,i=0;i<u;i++)r=t[i],this._addSetter(n,r)},Kinetic.Node.addPointSetters=function(n,t){for(var u=t.length,r,i=0;i<u;i++)r=t[i],this._addPointSetter(n,r)},Kinetic.Node.addRotationSetters=function(n,t){for(var u=t.length,r,i=0;i<u;i++)r=t[i],this._addRotationSetter(n,r)},Kinetic.Node.addGetters=function(n,t){for(var u=t.length,r,i=0;i<u;i++)r=t[i],this._addGetter(n,r)},Kinetic.Node.addRotationGetters=function(n,t){for(var u=t.length,r,i=0;i<u;i++)r=t[i],this._addRotationGetter(n,r)},Kinetic.Node.addGettersSetters=function(n,t){this.addSetters(n,t),this.addGetters(n,t)},Kinetic.Node.addPointGettersSetters=function(n,t){this.addPointSetters(n,t),this.addGetters(n,t)},Kinetic.Node.addRotationGettersSetters=function(n,t){this.addRotationSetters(n,t),this.addRotationGetters(n,t)},Kinetic.Node._addSetter=function(n,t){var r=this,i="set"+t.charAt(0).toUpperCase()+t.slice(1);n.prototype[i]=function(n){this.setAttr(t,n)}},Kinetic.Node._addPointSetter=function(n,t){var r=this,i="set"+t.charAt(0).toUpperCase()+t.slice(1);n.prototype[i]=function(){var n=Kinetic.Type._getXY([].slice.call(arguments));n&&n.x===undefined&&(n.x=this.attrs[t].x),n&&n.y===undefined&&(n.y=this.attrs[t].y),this.setAttr(t,n)}},Kinetic.Node._addRotationSetter=function(n,t){var r=this,i="set"+t.charAt(0).toUpperCase()+t.slice(1);n.prototype[i]=function(n){this.setAttr(t,n)},n.prototype[i+"Deg"]=function(n){this.setAttr(t,Kinetic.Type._degToRad(n))}},Kinetic.Node._addGetter=function(n,t){var r=this,i="get"+t.charAt(0).toUpperCase()+t.slice(1);n.prototype[i]=function(){return this.attrs[t]}},Kinetic.Node._addRotationGetter=function(n,t){var r=this,i="get"+t.charAt(0).toUpperCase()+t.slice(1);n.prototype[i]=function(){return this.attrs[t]},n.prototype[i+"Deg"]=function(){return Kinetic.Type._radToDeg(this.attrs[t])}},Kinetic.Node.create=function(n,t){return this._createNode(JSON.parse(n),t)},Kinetic.Node._createNode=function(n,t){var u,r,f,i;if(u=n.nodeType==="Shape"?n.shapeType===undefined?"Shape":n.shapeType:n.nodeType,t&&(n.attrs.container=t),r=new Kinetic[u](n.attrs),n.children)for(f=n.children.length,i=0;i<f;i++)r.add(this._createNode(n.children[i]));return r},Kinetic.Node.addGettersSetters(Kinetic.Node,["x","y","opacity"]),Kinetic.Node.addGetters(Kinetic.Node,["name","id"]),Kinetic.Node.addRotationGettersSetters(Kinetic.Node,["rotation"]),Kinetic.Node.addPointGettersSetters(Kinetic.Node,["scale","offset"]),Kinetic.Node.addSetters(Kinetic.Node,["width","height","listening","visible"]),Kinetic.Node.prototype.isListening=Kinetic.Node.prototype.getListening,Kinetic.Node.prototype.isVisible=Kinetic.Node.prototype.getVisible,t=["on","off"],n=0;n<2;n++)(function(n){var i=t[n];Kinetic.Collection.prototype[i]=function(){var n=[].slice.call(arguments);n.unshift(i),this.apply.apply(this,n)}})(n)}(),function(){Kinetic.DD={anim:new Kinetic.Animation,moving:!1,offset:{x:0,y:0}},Kinetic.DD._setupDragLayerAndGetContainer=function(n){var u=Kinetic.DD,t=n.getStage(),f=n.nodeType,i,r;return n._eachAncestorReverse(function(n){n.nodeType==="Layer"?(t.dragLayer.setAttrs({x:n.getX(),y:n.getY(),scale:n.getScale(),rotation:n.getRotation()}),i=t.dragLayer,t.add(t.dragLayer)):n.nodeType==="Group"&&(r=new Kinetic.Group({x:n.getX(),y:n.getY(),scale:n.getScale(),rotation:n.getRotation()}),i.add(r),i=r)}),i},Kinetic.DD._initDragLayer=function(n){n.dragLayer=new Kinetic.Layer,n.dragLayer.getCanvas().getElement().className="kinetic-drag-and-drop-layer"},Kinetic.DD._drag=function(n){var i=Kinetic.DD,t=i.node;if(t){var u=t.getStage().getUserPosition(),f=t.attrs.dragBoundFunc,r={x:u.x-i.offset.x,y:u.y-i.offset.y};f!==undefined&&(r=f.call(t,r,n)),t.setAbsolutePosition(r),i.moving||(i.moving=!0,t.setListening(!1),t._handleEvent("dragstart",n)),t._handleEvent("dragmove",n)}},Kinetic.DD._endDrag=function(n){var i=Kinetic.DD,t=i.node,r,u;t&&(r=t.nodeType,u=t.getStage(),t.setListening(!0),r==="Stage"?t.draw():((r==="Group"||r==="Shape")&&t.getDragOnTop()&&i.prevParent&&(t.moveTo(i.prevParent),t.getStage().dragLayer.remove(),i.prevParent=null),t.getLayer().draw()),i.moving&&(i.moving=!1,t._handleEvent("dragend",n))),delete i.node,i.anim.stop()},Kinetic.Node.prototype._startDrag=function(){var e=this,n=Kinetic.DD,t=this.getStage(),i=t.getUserPosition();if(i){var o=this.getTransform().getTranslation(),r=this.getAbsolutePosition(),u=this.nodeType,f;n.node=this,n.offset.x=i.x-r.x,n.offset.y=i.y-r.y,u==="Stage"||u==="Layer"?(n.anim.node=this,n.anim.start()):this.getDragOnTop()?(f=n._setupDragLayerAndGetContainer(this),n.anim.node=t.dragLayer,n.prevParent=this.getParent(),setTimeout(function(){n.node&&(e.moveTo(f),n.prevParent.getLayer().draw(),t.dragLayer.draw(),n.anim.start())},0)):(n.anim.node=this.getLayer(),n.anim.start())}},Kinetic.Node.prototype.setDraggable=function(n){this.setAttr("draggable",n),this._dragChange()},Kinetic.Node.prototype.getDraggable=function(){return this.attrs.draggable},Kinetic.Node.prototype.isDragging=function(){var n=Kinetic.DD;return n.node&&n.node._id===this._id&&n.moving},Kinetic.Node.prototype._listenDrag=function(){this._dragCleanup();this.on("mousedown.kinetic touchstart.kinetic",this._startDrag)},Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var t=this.getStage(),n=Kinetic.DD;t&&n.node&&n.node._id===this._id&&n._endDrag()}},Kinetic.Node.prototype._dragCleanup=function(){this.off("mousedown.kinetic"),this.off("touchstart.kinetic")},Kinetic.Node.prototype.isDraggable=Kinetic.Node.prototype.getDraggable,Kinetic.Node.addGettersSetters(Kinetic.Node,["dragBoundFunc","dragOnTop"])}(),function(){Kinetic.Transition=function(n,t){function u(n,t,r,f){for(var e in n)e!=="duration"&&e!=="easing"&&e!=="callback"&&(Kinetic.Type._isObject(n[e])?(r[e]={},u(n[e],t[e],r[e],f)):i._add(i._getTween(t,e,n[e],r,f)))}var i=this,r={};this.node=n,this.config=t,this.tweens=[],u(t,n.attrs,r,r),this.tweens[0].onStarted=function(){},this.tweens[0].onStopped=function(){n.transAnim.stop()},this.tweens[0].onResumed=function(){n.transAnim.start()},this.tweens[0].onLooped=function(){},this.tweens[0].onChanged=function(){},this.tweens[0].onFinished=function(){var r={},i;for(i in t)i!=="duration"&&i!=="easing"&&i!=="callback"&&(r[i]=t[i]);n.transAnim.stop(),n.setAttrs(r),t.callback&&t.callback()}},Kinetic.Transition.prototype={start:function(){for(var n=0;n<this.tweens.length;n++)this.tweens[n].start()},stop:function(){for(var n=0;n<this.tweens.length;n++)this.tweens[n].stop()},resume:function(){for(var n=0;n<this.tweens.length;n++)this.tweens[n].resume()},_onEnterFrame:function(){for(var n=0;n<this.tweens.length;n++)this.tweens[n].onEnterFrame()},_add:function(n){this.tweens.push(n)},_getTween:function(n,t,i,r,u){var e=this.config,o=this.node,f=e.easing;return f===undefined&&(f="linear"),new Kinetic.Tween(o,function(n){r[t]=n,o.setAttrs(u)},Kinetic.Tweens[f],n[t],i,e.duration)}},Kinetic.Node.prototype.transitionTo=function(n){var i=this,t=new Kinetic.Transition(this,n);return this.transAnim||(this.transAnim=new Kinetic.Animation),this.transAnim.func=function(){t._onEnterFrame()},this.transAnim.node=this.nodeType==="Stage"?this:this.getLayer(),t.start(),this.transAnim.start(),this.trans=t,t}}(),function(){Kinetic.Container=function(n){this._containerInit(n)},Kinetic.Container.prototype={_containerInit:function(n){this.children=[],Kinetic.Node.call(this,n)},getChildren:function(){return this.children},removeChildren:function(){while(this.children.length>0)this.children[0].remove()},add:function(n){var i=Kinetic.Global,t=this.children;return n.index=t.length,n.parent=this,t.push(n),this},get:function(n){var t=new Kinetic.Collection,r,f,i;if(n.charAt(0)==="#")r=this._getNodeById(n.slice(1)),r&&t.push(r);else if(n.charAt(0)===".")f=this._getNodesByName(n.slice(1)),Kinetic.Collection.apply(t,f);else{var u=[],e=this.getChildren(),o=e.length;for(i=0;i<o;i++)u=u.concat(e[i]._get(n));Kinetic.Collection.apply(t,u)}return t},_getNodeById:function(n){var r=this.getStage(),i=Kinetic.Global,t=i.ids[n];return t!==undefined&&this.isAncestorOf(t)?t:null},_getNodesByName:function(n){var t=Kinetic.Global,i=t.names[n]||[];return this._getDescendants(i)},_get:function(n){for(var i=Kinetic.Node.prototype._get.call(this,n),r=this.getChildren(),u=r.length,t=0;t<u;t++)i=i.concat(r[t]._get(n));return i},toObject:function(){var t=Kinetic.Node.prototype.toObject.call(this),i,r,n,u;for(t.children=[],i=this.getChildren(),r=i.length,n=0;n<r;n++)u=i[n],t.children.push(u.toObject());return t},_getDescendants:function(n){for(var r=[],u=n.length,i,t=0;t<u;t++)i=n[t],this.isAncestorOf(i)&&r.push(i);return r},isAncestorOf:function(n){for(var t=n.getParent();t;){if(t._id===this._id)return!0;t=t.getParent()}return!1},clone:function(n){var t=Kinetic.Node.prototype.clone.call(this,n),i;for(i in this.children)t.add(this.children[i].clone());return t},getIntersections:function(){for(var u=Kinetic.Type._getXY(Array.prototype.slice.call(arguments)),i=[],r=this.get("Shape"),f=r.length,t,n=0;n<f;n++)t=r[n],t.isVisible()&&t.intersects(u)&&i.push(t);return i},_setChildrenIndices:function(){for(var t=this.children,i=t.length,n=0;n<i;n++)t[n].index=n},draw:function(){this.drawScene(),this.drawHit()},drawScene:function(n){var i,r,t;if(this.isVisible())for(i=this.children,r=i.length,t=0;t<r;t++)i[t].drawScene(n)},drawHit:function(){var t,i,n;if(this.isVisible()&&this.isListening())for(t=this.children,i=t.length,n=0;n<i;n++)t[n].drawHit()}},Kinetic.Global.extend(Kinetic.Container,Kinetic.Node)}(),function(){Kinetic.Stage=function(n){this._initStage(n)},Kinetic.Stage.prototype={_initStage:function(n){var t=Kinetic.DD;this.setDefaultAttrs({width:400,height:200}),Kinetic.Container.call(this,n),this._setStageDefaultProperties(),this._id=Kinetic.Global.idCounter++,this._buildDOM(),this._bindContentEvents(),Kinetic.Global.stages.push(this),t&&t._initDragLayer(this)},setContainer:function(n){typeof n=="string"&&(n=document.getElementById(n)),this.setAttr("container",n)},setHeight:function(n){Kinetic.Node.prototype.setHeight.call(this,n),this._resizeDOM()},setWidth:function(n){Kinetic.Node.prototype.setWidth.call(this,n),this._resizeDOM()},clear:function(){for(var t=this.children,n=0;n<t.length;n++)t[n].clear()},remove:function(){var n=this.content;Kinetic.Node.prototype.remove.call(this),n&&Kinetic.Type._isInDocument(n)&&this.attrs.container.removeChild(n)},reset:function(){this.removeChildren(),this._setStageDefaultProperties(),this.setAttrs(this.defaultNodeAttrs)},getMousePosition:function(){return this.mousePos},getTouchPosition:function(){return this.touchPos},getUserPosition:function(){return this.getTouchPosition()||this.getMousePosition()},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(n){function e(t){var h=f[t],c=h.toDataURL(),i=new Image;i.onload=function(){u.drawImage(i,0,0),t<f.length-1?e(t+1):n.callback(r.toDataURL(o,s))},i.src=c}n=n||{};var o=n.mimeType||null,s=n.quality||null,t=n.x||0,i=n.y||0,r=new Kinetic.SceneCanvas(n.width||this.getWidth(),n.height||this.getHeight()),u=r.getContext(),f=this.children;(t||i)&&u.translate(-1*t,-1*i),e(0)},toImage:function(n){var t=n.callback;n.callback=function(n){Kinetic.Type._getImage(n,function(n){t(n)})},this.toDataURL(n)},getIntersection:function(n){for(var u,f=this.getChildren(),r,t,e,i=f.length-1;i>=0;i--)if(r=f[i],r.isVisible()&&r.isListening()){if(t=r.hitCanvas.context.getImageData(Math.round(n.x),Math.round(n.y),1,1).data,t[3]===255)return e=Kinetic.Type._rgbToHex(t[0],t[1],t[2]),u=Kinetic.Global.shapes[e],{shape:u,pixel:t};if(t[0]>0||t[1]>0||t[2]>0||t[3]>0)return{pixel:t}}return null},_resizeDOM:function(){var n,t,u,i,r;if(this.content)for(n=this.attrs.width,t=this.attrs.height,this.content.style.width=n+"px",this.content.style.height=t+"px",this.bufferCanvas.setSize(n,t),this.hitCanvas.setSize(n,t),u=this.children,i=0;i<u.length;i++)r=u[i],r.getCanvas().setSize(n,t),r.hitCanvas.setSize(n,t),r.draw()},add:function(n){return Kinetic.Container.prototype.add.call(this,n),n.canvas.setSize(this.attrs.width,this.attrs.height),n.hitCanvas.setSize(this.attrs.width,this.attrs.height),n.draw(),this.content.appendChild(n.canvas.element),this},getDragLayer:function(){return this.dragLayer},_setUserPosition:function(n){n||(n=window.event),this._setMousePosition(n),this._setTouchPosition(n)},_bindContentEvents:function(){for(var u=Kinetic.Global,t=this,i=["mousedown","mousemove","mouseup","mouseout","touchstart","touchmove","touchend"],r,n=0;n<i.length;n++)r=i[n],function(){var n=r;t.content.addEventListener(n,function(i){t["_"+n](i)},!1)}()},_mouseout:function(n){this._setUserPosition(n);var i=Kinetic.DD,t=this.targetShape;!t||i&&i.moving||(t._handleEvent("mouseout",n),t._handleEvent("mouseleave",n),this.targetShape=null),this.mousePos=undefined},_mousemove:function(n){var i,r,t;this._setUserPosition(n),i=Kinetic.DD,r=this.getIntersection(this.getUserPosition()),r?(t=r.shape,t&&(i&&i.moving||r.pixel[3]!==255||this.targetShape&&this.targetShape._id===t._id?t._handleEvent("mousemove",n):(this.targetShape&&(this.targetShape._handleEvent("mouseout",n,t),this.targetShape._handleEvent("mouseleave",n,t)),t._handleEvent("mouseover",n,this.targetShape),t._handleEvent("mouseenter",n,this.targetShape),this.targetShape=t))):!this.targetShape||i&&i.moving||(this.targetShape._handleEvent("mouseout",n),this.targetShape._handleEvent("mouseleave",n),this.targetShape=null),i&&i._drag(n)},_mousedown:function(n){var t,i;this._setUserPosition(n),t=this.getIntersection(this.getUserPosition()),t&&t.shape&&(i=t.shape,this.clickStart=!0,i._handleEvent("mousedown",n)),Kinetic.DD&&this.attrs.draggable&&this._startDrag()},_mouseup:function(n){var i;this._setUserPosition(n);var u=this,t=Kinetic.DD,r=this.getIntersection(this.getUserPosition());t&&t._endDrag(n),r&&r.shape&&(i=r.shape,i._handleEvent("mouseup",n),this.clickStart&&(t&&t.moving&&t.node||(i._handleEvent("click",n),this.inDoubleClickWindow&&i._handleEvent("dblclick",n),this.inDoubleClickWindow=!0,setTimeout(function(){u.inDoubleClickWindow=!1},this.dblClickWindow)))),this.clickStart=!1},_touchstart:function(n){var t,i;this._setUserPosition(n),n.preventDefault(),t=this.getIntersection(this.getUserPosition()),t&&t.shape&&(i=t.shape,this.tapStart=!0,i._handleEvent("touchstart",n)),Kinetic.DD&&this.attrs.draggable&&this._startDrag()},_touchend:function(n){var i;this._setUserPosition(n);var u=this,t=Kinetic.DD,r=this.getIntersection(this.getUserPosition());t&&t._endDrag(n),r&&r.shape&&(i=r.shape,i._handleEvent("touchend",n),this.tapStart&&(t&&t.moving&&t.node||(i._handleEvent("tap",n),this.inDoubleClickWindow&&i._handleEvent("dbltap",n),this.inDoubleClickWindow=!0,setTimeout(function(){u.inDoubleClickWindow=!1},this.dblClickWindow)))),this.tapStart=!1},_touchmove:function(n){var i,t,r;this._setUserPosition(n),i=Kinetic.DD,n.preventDefault(),t=this.getIntersection(this.getUserPosition()),t&&t.shape&&(r=t.shape,r._handleEvent("touchmove",n)),i&&i._drag(n)},_setMousePosition:function(n){var t=n.clientX-this._getContentPosition().left,i=n.clientY-this._getContentPosition().top;this.mousePos={x:t,y:i}},_setTouchPosition:function(n){if(n.touches!==undefined&&n.touches.length===1){var t=n.touches[0],i=t.clientX-this._getContentPosition().left,r=t.clientY-this._getContentPosition().top;this.touchPos={x:i,y:r}}},_getContentPosition:function(){var n=this.content.getBoundingClientRect();return{top:n.top,left:n.left}},_buildDOM:function(){this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.display="inline-block",this.content.className="kineticjs-content",this.attrs.container.appendChild(this.content),this.bufferCanvas=new Kinetic.SceneCanvas,this.hitCanvas=new Kinetic.HitCanvas,this._resizeDOM()},_onContent:function(n,t){for(var r=n.split(" "),u,i=0;i<r.length;i++)u=r[i],this.content.addEventListener(u,t,!1)},_setStageDefaultProperties:function(){this.nodeType="Stage",this.dblClickWindow=400,this.targetShape=null,this.mousePos=undefined,this.clickStart=!1,this.touchPos=undefined,this.tapStart=!1}},Kinetic.Global.extend(Kinetic.Stage,Kinetic.Container),Kinetic.Node.addGetters(Kinetic.Stage,["container"])}(),function(){Kinetic.Layer=function(n){this._initLayer(n)},Kinetic.Layer.prototype={_initLayer:function(n){this.setDefaultAttrs({clearBeforeDraw:!0}),this.nodeType="Layer",this.beforeDrawFunc=undefined,this.afterDrawFunc=undefined,this.canvas=new Kinetic.SceneCanvas,this.canvas.getElement().style.position="absolute",this.hitCanvas=new Kinetic.HitCanvas,Kinetic.Container.call(this,n)},draw:function(){this.beforeDrawFunc!==undefined&&this.beforeDrawFunc.call(this),Kinetic.Container.prototype.draw.call(this),this.afterDrawFunc!==undefined&&this.afterDrawFunc.call(this)},drawHit:function(){this.hitCanvas.clear(),Kinetic.Container.prototype.drawHit.call(this)},drawScene:function(n){n=n||this.getCanvas(),this.attrs.clearBeforeDraw&&n.clear(),Kinetic.Container.prototype.drawScene.call(this,n)},toDataURL:function(n){n=n||{};var t=n.mimeType||null,i=n.quality||null,r=n.x||0,u=n.y||0;return n.width||n.height||n.x||n.y?Kinetic.Node.prototype.toDataURL.call(this,n):this.getCanvas().toDataURL(t,i)},beforeDraw:function(n){this.beforeDrawFunc=n},afterDraw:function(n){this.afterDrawFunc=n},getCanvas:function(){return this.canvas},getContext:function(){return this.canvas.context},clear:function(){this.getCanvas().clear()},setVisible:function(n){Kinetic.Node.prototype.setVisible.call(this,n),n?(this.canvas.element.style.display="block",this.hitCanvas.element.style.display="block"):(this.canvas.element.style.display="none",this.hitCanvas.element.style.display="none")},setZIndex:function(n){Kinetic.Node.prototype.setZIndex.call(this,n);var t=this.getStage();t&&(t.content.removeChild(this.canvas.element),n<t.getChildren().length-1?t.content.insertBefore(this.canvas.element,t.getChildren()[n+1].canvas.element):t.content.appendChild(this.canvas.element))},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var n=this.getStage();n&&(n.content.removeChild(this.canvas.element),n.content.appendChild(this.canvas.element))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var n=this.getStage();n&&(n.content.removeChild(this.canvas.element),this.index<n.getChildren().length-1?n.content.insertBefore(this.canvas.element,n.getChildren()[this.index+1].canvas.element):n.content.appendChild(this.canvas.element))}},moveDown:function(){var n,t;Kinetic.Node.prototype.moveDown.call(this)&&(n=this.getStage(),n&&(t=n.getChildren(),n.content.removeChild(this.canvas.element),n.content.insertBefore(this.canvas.element,t[this.index+1].canvas.element)))},moveToBottom:function(){var n,t;Kinetic.Node.prototype.moveToBottom.call(this)&&(n=this.getStage(),n&&(t=n.getChildren(),n.content.removeChild(this.canvas.element),n.content.insertBefore(this.canvas.element,t[1].canvas.element)))},getLayer:function(){return this},remove:function(){var n=this.getStage(),t=this.canvas,i=t.element;Kinetic.Node.prototype.remove.call(this),n&&t&&Kinetic.Type._isInDocument(i)&&n.content.removeChild(i)}},Kinetic.Global.extend(Kinetic.Layer,Kinetic.Container),Kinetic.Node.addGettersSetters(Kinetic.Layer,["clearBeforeDraw"])}(),function(){Kinetic.Group=function(n){this._initGroup(n)},Kinetic.Group.prototype={_initGroup:function(n){this.nodeType="Group",Kinetic.Container.call(this,n)}},Kinetic.Global.extend(Kinetic.Group,Kinetic.Container)}(),function(){Kinetic.Shape=function(n){this._initShape(n)},Kinetic.Shape.prototype={_initShape:function(n){this.nodeType="Shape";for(var i=Kinetic.Global.shapes,t;;)if(t=Kinetic.Type._getRandomColorKey(),t&&!(t in i))break;this.colorKey=t,i[t]=this,Kinetic.Node.call(this,n)},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffset())},_get:function(n){return this.nodeType===n||this.shapeType===n?[this]:[]},intersects:function(){var t=Kinetic.Type._getXY(Array.prototype.slice.call(arguments)),r=this.getStage(),n=r.hitCanvas,i;return n.clear(),this.drawScene(n),i=n.context.getImageData(Math.round(t.x),Math.round(t.y),1,1).data,i[3]>0},remove:function(){Kinetic.Node.prototype.remove.call(this),delete Kinetic.Global.shapes[this.colorKey]},drawScene:function(n){var r=this.attrs,t=r.drawFunc,n=n||this.getLayer().getCanvas(),i=n.getContext();t&&this.isVisible()&&(i.save(),n._handlePixelRatio(),n._applyOpacity(this),n._applyLineJoin(this),n._applyAncestorTransforms(this),t.call(this,n),i.restore())},drawHit:function(){var t=this.attrs,i=t.drawHitFunc||t.drawFunc,n=this.getLayer().hitCanvas,r=n.getContext();i&&this.isVisible()&&this.isListening()&&(r.save(),n._applyLineJoin(this),n._applyAncestorTransforms(this),i.call(this,n),r.restore())},_setDrawFuncs:function(){!this.attrs.drawFunc&&this.drawFunc&&this.setDrawFunc(this.drawFunc),!this.attrs.drawHitFunc&&this.drawHitFunc&&this.setDrawHitFunc(this.drawHitFunc)}},Kinetic.Global.extend(Kinetic.Shape,Kinetic.Node),Kinetic.Node.addGettersSetters(Kinetic.Shape,["stroke","lineJoin","lineCap","strokeWidth","drawFunc","drawHitFunc","dashArray","shadowColor","shadowBlur","shadowOpacity","fillPatternImage","fill","fillPatternX","fillPatternY","fillLinearGradientColorStops","fillRadialGradientStartRadius","fillRadialGradientEndRadius","fillRadialGradientColorStops","fillPatternRepeat"]),Kinetic.Node.addPointGettersSetters(Kinetic.Shape,["fillPatternOffset","fillPatternScale","fillLinearGradientStartPoint","fillLinearGradientEndPoint","fillRadialGradientStartPoint","fillRadialGradientEndPoint","shadowOffset"]),Kinetic.Node.addRotationGettersSetters(Kinetic.Shape,["fillPatternRotation"])}(),function(){Kinetic.Rect=function(n){this._initRect(n)},Kinetic.Rect.prototype={_initRect:function(n){this.setDefaultAttrs({width:0,height:0,cornerRadius:0}),Kinetic.Shape.call(this,n),this.shapeType="Rect",this._setDrawFuncs()},drawFunc:function(n){var i=n.getContext();i.beginPath();var t=this.getCornerRadius(),r=this.getWidth(),u=this.getHeight();t===0?i.rect(0,0,r,u):(i.moveTo(t,0),i.lineTo(r-t,0),i.arc(r-t,t,t,Math.PI*3/2,0,!1),i.lineTo(r,u-t),i.arc(r-t,u-t,t,0,Math.PI/2,!1),i.lineTo(t,u),i.arc(t,u-t,t,Math.PI/2,Math.PI,!1),i.lineTo(0,t),i.arc(t,t,t,Math.PI,Math.PI*3/2,!1)),i.closePath(),n.fillStroke(this)}},Kinetic.Global.extend(Kinetic.Rect,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Rect,["cornerRadius"])}(),function(){Kinetic.Circle=function(n){this._initCircle(n)},Kinetic.Circle.prototype={_initCircle:function(n){this.setDefaultAttrs({radius:0}),Kinetic.Shape.call(this,n),this.shapeType="Circle",this._setDrawFuncs()},drawFunc:function(n){var t=n.getContext();t.beginPath(),t.arc(0,0,this.getRadius(),0,Math.PI*2,!0),t.closePath(),n.fillStroke(this)},getWidth:function(){return this.getRadius()*2},getHeight:function(){return this.getRadius()*2},setWidth:function(n){Kinetic.Node.prototype.setWidth.call(this,n),this.setRadius(n/2)},setHeight:function(n){Kinetic.Node.prototype.setHeight.call(this,n),this.setRadius(n/2)}},Kinetic.Global.extend(Kinetic.Circle,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Circle,["radius"])}(),function(){Kinetic.Wedge=function(n){this._initWedge(n)},Kinetic.Wedge.prototype={_initWedge:function(n){this.setDefaultAttrs({radius:0,angle:0,clickwise:!0}),Kinetic.Shape.call(this,n),this.shapeType="Wedge",this._setDrawFuncs()},drawFunc:function(n){var t=n.getContext();t.beginPath(),t.arc(0,0,this.getRadius(),0,this.getAngle(),this.getClockwise()),t.lineTo(0,0),t.closePath(),n.fillStroke(this)},setAngleDeg:function(n){this.setAngle(Kinetic.Type._degToRad(n))},getAngleDeg:function(){return Kinetic.Type._radToDeg(this.getAngle())}},Kinetic.Global.extend(Kinetic.Wedge,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Wedge,["radius","angle","clockwise"])}(),function(){Kinetic.Ellipse=function(n){this._initEllipse(n)},Kinetic.Ellipse.prototype={_initEllipse:function(n){this.setDefaultAttrs({radius:{x:0,y:0}}),Kinetic.Shape.call(this,n),this.shapeType="Ellipse",this._setDrawFuncs()},drawFunc:function(n){var t=n.getContext(),i=this.getRadius();t.beginPath(),t.save(),i.x!==i.y&&t.scale(1,i.y/i.x),t.arc(0,0,i.x,0,Math.PI*2,!0),t.restore(),t.closePath(),n.fillStroke(this)},getWidth:function(){return this.getRadius().x*2},getHeight:function(){return this.getRadius().y*2},setWidth:function(n){Kinetic.Node.prototype.setWidth.call(this,n),this.setRadius({x:n/2})},setHeight:function(n){Kinetic.Node.prototype.setHeight.call(this,n),this.setRadius({y:n/2})}},Kinetic.Global.extend(Kinetic.Ellipse,Kinetic.Shape),Kinetic.Node.addPointGettersSetters(Kinetic.Ellipse,["radius"])}(),function(){Kinetic.Image=function(n){this._initImage(n)},Kinetic.Image.prototype={_initImage:function(n){Kinetic.Shape.call(this,n),this.shapeType="Image",this._setDrawFuncs();var t=this;this.on("imageChange",function(){t._syncSize()});this._syncSize()},drawFunc:function(n){var r=this.getWidth(),u=this.getHeight(),i,f=this,t=n.getContext();if(t.beginPath(),t.rect(0,0,r,u),t.closePath(),n.fillStroke(this),this.attrs.image){if(this.attrs.crop&&this.attrs.crop.width&&this.attrs.crop.height){var e=this.attrs.crop.x||0,o=this.attrs.crop.y||0,s=this.attrs.crop.width,h=this.attrs.crop.height;i=[this.attrs.image,e,o,s,h,0,0,r,u]}else i=[this.attrs.image,0,0,r,u];this.hasShadow()?n.applyShadow(this,function(){f._drawImage(t,i)}):this._drawImage(t,i)}},drawHitFunc:function(n){var i=this.getWidth(),r=this.getHeight(),u=this.imageHitRegion,t=n.getContext();u?(t.drawImage(u,0,0,i,r),t.beginPath(),t.rect(0,0,i,r),t.closePath(),n.stroke(this)):(t.beginPath(),t.rect(0,0,i,r),t.closePath(),n.fillStroke(this))},applyFilter:function(n,t,i){var r=new Kinetic.Canvas(this.attrs.image.width,this.attrs.image.height),f=r.getContext(),u,e;f.drawImage(this.attrs.image,0,0);try{u=f.getImageData(0,0,r.getWidth(),r.getHeight()),n(u,t),e=this,Kinetic.Type._getImage(u,function(n){e.setImage(n),i&&i()})}catch(o){Kinetic.Global.warn("Unable to apply filter. "+o.message)}},setCrop:function(){var n=[].slice.call(arguments),t=Kinetic.Type._getXY(n),i=Kinetic.Type._getSize(n),r=Kinetic.Type._merge(t,i);this.setAttr("crop",Kinetic.Type._merge(r,this.getCrop()))},createImageHitRegion:function(n){var r=new Kinetic.Canvas(this.attrs.width,this.attrs.height),f=r.getContext(),t,o,s;f.drawImage(this.attrs.image,0,0);try{var e=f.getImageData(0,0,r.getWidth(),r.getHeight()),i=e.data,u=Kinetic.Type._hexToRgb(this.colorKey);for(t=0,o=i.length;t<o;t+=4)i[t]=u.r,i[t+1]=u.g,i[t+2]=u.b;s=this,Kinetic.Type._getImage(e,function(t){s.imageHitRegion=t,n&&n()})}catch(h){Kinetic.Global.warn("Unable to create image hit region. "+h.message)}},clearImageHitRegion:function(){delete this.imageHitRegion},_syncSize:function(){this.attrs.image&&(this.attrs.width||this.setWidth(this.attrs.image.width),this.attrs.height||this.setHeight(this.attrs.image.height))},_drawImage:function(n,t){t.length===5?n.drawImage(t[0],t[1],t[2],t[3],t[4]):t.length===9&&n.drawImage(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}},Kinetic.Global.extend(Kinetic.Image,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Image,["image"]),Kinetic.Node.addGetters(Kinetic.Image,["crop"])}(),function(){Kinetic.Polygon=function(n){this._initPolygon(n)},Kinetic.Polygon.prototype={_initPolygon:function(n){this.setDefaultAttrs({points:[]}),Kinetic.Shape.call(this,n),this.shapeType="Polygon",this._setDrawFuncs()},drawFunc:function(n){var r=n.getContext(),t=this.getPoints(),u=t.length,i;for(r.beginPath(),r.moveTo(t[0].x,t[0].y),i=1;i<u;i++)r.lineTo(t[i].x,t[i].y);r.closePath(),n.fillStroke(this)},setPoints:function(n){this.setAttr("points",Kinetic.Type._getPoints(n))}},Kinetic.Global.extend(Kinetic.Polygon,Kinetic.Shape),Kinetic.Node.addGetters(Kinetic.Polygon,["points"])}(),function(){Kinetic.Text=function(n){this._initText(n)},Kinetic.Text.prototype={_initText:function(n){var i,r,t,u;for(this.setDefaultAttrs({fontFamily:"Calibri",text:"",fontSize:12,align:"left",verticalAlign:"top",fontStyle:"normal",padding:0,width:"auto",height:"auto",lineHeight:1}),this.dummyCanvas=document.createElement("canvas"),Kinetic.Shape.call(this,n),this.shapeType="Text",this._setDrawFuncs(),i=["fontFamily","fontSize","fontStyle","padding","align","lineHeight","text","width","height"],r=this,t=0;t<i.length;t++){u=i[t];this.on(u+"Change.kinetic",r._setTextData)}r._setTextData()},drawFunc:function(n){var t=n.getContext(),i=this.attrs.padding,e=this.attrs.lineHeight*this.getTextHeight(),f=this.textArr,r,u;for(t.font=this.attrs.fontStyle+" "+this.attrs.fontSize+"px "+this.attrs.fontFamily,t.textBaseline="middle",t.textAlign="left",t.save(),t.translate(i,0),t.translate(0,i+this.getTextHeight()/2),r=0;r<f.length;r++)u=f[r],t.save(),this.attrs.align==="right"?t.translate(this.getWidth()-this._getTextSize(u).width-i*2,0):this.attrs.align==="center"&&t.translate((this.getWidth()-this._getTextSize(u).width-i*2)/2,0),n.fillStrokeText(this,u),t.restore(),t.translate(0,e);t.restore()},drawHitFunc:function(n){var t=n.getContext(),i=this.getWidth(),r=this.getHeight();t.beginPath(),t.rect(0,0,i,r),t.closePath(),n.fillStroke(this)},setText:function(n){var t=Kinetic.Type._isString(n)?n:n.toString();this.setAttr("text",t)},getWidth:function(){return this.attrs.width==="auto"?this.getTextWidth()+this.attrs.padding*2:this.attrs.width},getHeight:function(){return this.attrs.height==="auto"?this.getTextHeight()*this.textArr.length*this.attrs.lineHeight+this.attrs.padding*2:this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(n){var r=this.dummyCanvas,t=r.getContext("2d"),i;return t.save(),t.font=this.attrs.fontStyle+" "+this.attrs.fontSize+"px "+this.attrs.fontFamily,i=t.measureText(n),t.restore(),{width:i.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var t=this.attrs.text.split(""),f=[],e=0,u=!0,o,n,i,r;for(this.textWidth=0,this.textHeight=this._getTextSize(this.attrs.text).height,o=this.attrs.lineHeight*this.textHeight;t.length>0&&u&&(this.attrs.height==="auto"||o*(e+1)<this.attrs.height-this.attrs.padding*2);){for(n=0,i=undefined,u=!1;n<t.length;){if(t.indexOf("\n")===n){t.splice(n,1),i=t.splice(0,n).join("");break}if(r=t.slice(0,n),this.attrs.width!=="auto"&&this._getTextSize(r.join("")).width>this.attrs.width-this.attrs.padding*2){if(n==0)break;var h=r.lastIndexOf(" "),c=r.lastIndexOf("-"),s=Math.max(h,c);if(s>=0){i=t.splice(0,1+s).join("");break}i=t.splice(0,n).join("");break}n++,n===t.length&&(i=t.splice(0,n).join(""))}this.textWidth=Math.max(this.textWidth,this._getTextSize(i).width),i!==undefined&&(f.push(i),u=!0),e++}this.textArr=f}},Kinetic.Global.extend(Kinetic.Text,Kinetic.Shape);var n=function(n,t,i){var u=n.getFill(),r=this.context;u&&(r.save(),!i&&n.hasShadow()&&this._applyShadow(n),r.fillStyle=u,r.fillText(t,0,0),r.restore(),!i&&n.hasShadow()&&this.fillText(n,t,!0))},t=function(n,t,i){var u=n.getStroke(),f=n.getStrokeWidth(),r=this.context;(u||f)&&(r.save(),!i&&n.hasShadow()&&this._applyShadow(n),r.lineWidth=f||2,r.strokeStyle=u||"black",r.strokeText(t,0,0),r.restore(),!i&&n.hasShadow()&&this.strokeText(n,t,!0))},i=function(n,t){this.fillText(n,t),this.strokeText(n,t,n.hasShadow()&&n.getFill())};Kinetic.SceneCanvas.prototype.fillText=n,Kinetic.SceneCanvas.prototype.strokeText=t,Kinetic.SceneCanvas.prototype.fillStrokeText=i,Kinetic.HitCanvas.prototype.fillText=n,Kinetic.HitCanvas.prototype.strokeText=t,Kinetic.HitCanvas.prototype.fillStrokeText=i,Kinetic.Node.addGettersSetters(Kinetic.Text,["fontFamily","fontSize","fontStyle","padding","align","lineHeight"]),Kinetic.Node.addGetters(Kinetic.Text,["text"])}(),function(){Kinetic.Line=function(n){this._initLine(n)},Kinetic.Line.prototype={_initLine:function(n){this.setDefaultAttrs({points:[],lineCap:"butt"}),Kinetic.Shape.call(this,n),this.shapeType="Line",this._setDrawFuncs()},drawFunc:function(n){var t=this.getPoints(),f=t.length,r=n.getContext(),i,u;for(r.beginPath(),r.moveTo(t[0].x,t[0].y),i=1;i<f;i++)u=t[i],r.lineTo(u.x,u.y);n.stroke(this)},setPoints:function(n){this.setAttr("points",Kinetic.Type._getPoints(n))}},Kinetic.Global.extend(Kinetic.Line,Kinetic.Shape),Kinetic.Node.addGetters(Kinetic.Line,["points"])}(),function(){Kinetic.Spline=function(n){this._initSpline(n)},Kinetic.Spline._getControlPoints=function(n,t,i,r){var e=n.x,o=n.y,u=t.x,f=t.y,s=i.x,h=i.y,c=Math.sqrt(Math.pow(u-e,2)+Math.pow(f-o,2)),l=Math.sqrt(Math.pow(s-u,2)+Math.pow(h-f,2)),a=r*c/(c+l),v=r*l/(c+l),y=u-a*(s-e),p=f-a*(h-o),w=u+v*(s-e),b=f+v*(h-o);return[{x:y,y:p},{x:w,y:b}]},Kinetic.Spline.prototype={_initSpline:function(n){this.setDefaultAttrs({tension:1}),Kinetic.Line.call(this,n),this.shapeType="Spline"},drawFunc:function(n){var r=this.getPoints(),f=r.length,u=n.getContext(),s=this.getTension(),t,e,i,o;if(u.beginPath(),u.moveTo(r[0].x,r[0].y),s!==0&&f>2){for(t=this.allPoints,e=t.length,u.quadraticCurveTo(t[0].x,t[0].y,t[1].x,t[1].y),i=2;i<e-1;)u.bezierCurveTo(t[i].x,t[i++].y,t[i].x,t[i++].y,t[i].x,t[i++].y);u.quadraticCurveTo(t[e-1].x,t[e-1].y,r[f-1].x,r[f-1].y)}else for(i=1;i<f;i++)o=r[i],u.lineTo(o.x,o.y);n.stroke(this)},setPoints:function(n){Kinetic.Line.prototype.setPoints.call(this,n),this._setAllPoints()},setTension:function(n){this.setAttr("tension",n),this._setAllPoints()},_setAllPoints:function(){for(var t=this.getPoints(),u=t.length,f=this.getTension(),i=[],r,n=1;n<u-1;n++)r=Kinetic.Spline._getControlPoints(t[n-1],t[n],t[n+1],f),i.push(r[0]),i.push(t[n]),i.push(r[1]);this.allPoints=i}},Kinetic.Global.extend(Kinetic.Spline,Kinetic.Line),Kinetic.Node.addGetters(Kinetic.Spline,["tension"])}(),function(){Kinetic.Blob=function(n){this._initBlob(n)},Kinetic.Blob.prototype={_initBlob:function(n){Kinetic.Spline.call(this,n),this.shapeType="Blob"},drawFunc:function(n){var u=this.getPoints(),e=u.length,r=n.getContext(),o=this.getTension(),t,f;if(r.beginPath(),r.moveTo(u[0].x,u[0].y),o!==0&&e>2)for(var i=this.allPoints,s=i.length,t=0;t<s-1;)r.bezierCurveTo(i[t].x,i[t++].y,i[t].x,i[t++].y,i[t].x,i[t++].y);else for(t=1;t<e;t++)f=u[t],r.lineTo(f.x,f.y);r.closePath(),n.fillStroke(this)},_setAllPoints:function(){var n=this.getPoints(),t=n.length,i=this.getTension(),r=Kinetic.Spline._getControlPoints(n[t-1],n[0],n[1],i),u=Kinetic.Spline._getControlPoints(n[t-2],n[t-1],n[0],i);Kinetic.Spline.prototype._setAllPoints.call(this),this.allPoints.unshift(r[1]),this.allPoints.push(u[0]),this.allPoints.push(n[t-1]),this.allPoints.push(u[1]),this.allPoints.push(r[0]),this.allPoints.push(n[0])}},Kinetic.Global.extend(Kinetic.Blob,Kinetic.Spline)}(),function(){Kinetic.Sprite=function(n){this._initSprite(n)},Kinetic.Sprite.prototype={_initSprite:function(n){this.setDefaultAttrs({index:0,frameRate:17}),Kinetic.Shape.call(this,n),this.shapeType="Sprite",this._setDrawFuncs(),this.anim=new Kinetic.Animation;var t=this;this.on("animationChange",function(){t.setIndex(0)})},drawFunc:function(n){var r=this.attrs.animation,u=this.attrs.index,t=this.attrs.animations[r][u],f=n.getContext(),i=this.attrs.image;i&&f.drawImage(i,t.x,t.y,t.width,t.height,0,0,t.width,t.height)},drawHitFunc:function(n){var r=this.attrs.animation,u=this.attrs.index,i=this.attrs.animations[r][u],t=n.getContext();t.beginPath(),t.rect(0,0,i.width,i.height),t.closePath(),n.fill(this)},start:function(){var n=this,t=this.getLayer();this.anim.node=t,this.interval=setInterval(function(){var t=n.attrs.index;n._updateIndex(),n.afterFrameFunc&&t===n.afterFrameIndex&&(n.afterFrameFunc(),delete n.afterFrameFunc,delete n.afterFrameIndex)},1e3/this.attrs.frameRate),this.anim.start()},stop:function(){this.anim.stop(),clearInterval(this.interval)},afterFrame:function(n,t){this.afterFrameIndex=n,this.afterFrameFunc=t},_updateIndex:function(){var n=this.attrs.index,t=this.attrs.animation;n<this.attrs.animations[t].length-1?this.attrs.index++:this.attrs.index=0}},Kinetic.Global.extend(Kinetic.Sprite,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Sprite,["animation","animations","index"])}(),function(){Kinetic.Star=function(n){this._initStar(n)},Kinetic.Star.prototype={_initStar:function(n){this.setDefaultAttrs({numPoints:0,innerRadius:0,outerRadius:0}),Kinetic.Shape.call(this,n),this.shapeType="Star",this._setDrawFuncs()},drawFunc:function(n){var i=n.getContext(),f=this.attrs.innerRadius,e=this.attrs.outerRadius,r=this.attrs.numPoints,t;for(i.beginPath(),i.moveTo(0,0-this.attrs.outerRadius),t=1;t<r*2;t++){var u=t%2==0?e:f,o=u*Math.sin(t*Math.PI/r),s=-1*u*Math.cos(t*Math.PI/r);i.lineTo(o,s)}i.closePath(),n.fillStroke(this)}},Kinetic.Global.extend(Kinetic.Star,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Star,["numPoints","innerRadius","outerRadius"])}(),function(){Kinetic.RegularPolygon=function(n){this._initRegularPolygon(n)},Kinetic.RegularPolygon.prototype={_initRegularPolygon:function(n){this.setDefaultAttrs({radius:0,sides:0}),Kinetic.Shape.call(this,n),this.shapeType="RegularPolygon",this._setDrawFuncs()},drawFunc:function(n){var i=n.getContext(),r=this.attrs.sides,u=this.attrs.radius,t,f,e;for(i.beginPath(),i.moveTo(0,0-u),t=1;t<r;t++)f=u*Math.sin(t*2*Math.PI/r),e=-1*u*Math.cos(t*2*Math.PI/r),i.lineTo(f,e);i.closePath(),n.fillStroke(this)}},Kinetic.Global.extend(Kinetic.RegularPolygon,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.RegularPolygon,["radius","sides"])}(),function(){Kinetic.Path=function(n){this._initPath(n)},Kinetic.Path.prototype={_initPath:function(n){this.dataArray=[];var t=this;Kinetic.Shape.call(this,n),this.shapeType="Path",this._setDrawFuncs(),this.dataArray=Kinetic.Path.parsePathData(this.attrs.data);this.on("dataChange",function(){t.dataArray=Kinetic.Path.parsePathData(t.attrs.data)})},drawFunc:function(n){var e=this.dataArray,i=n.getContext(),f,o,t;for(i.beginPath(),f=0;f<e.length;f++){o=e[f].command,t=e[f].points;switch(o){case"L":i.lineTo(t[0],t[1]);break;case"M":i.moveTo(t[0],t[1]);break;case"C":i.bezierCurveTo(t[0],t[1],t[2],t[3],t[4],t[5]);break;case"Q":i.quadraticCurveTo(t[0],t[1],t[2],t[3]);break;case"A":var s=t[0],h=t[1],r=t[2],u=t[3],c=t[4],y=t[5],l=t[6],p=t[7],w=r>u?r:u,a=r>u?1:r/u,v=r>u?u/r:1;i.translate(s,h),i.rotate(l),i.scale(a,v),i.arc(0,0,w,c,c+y,1-p),i.scale(1/a,1/v),i.rotate(-l),i.translate(-s,-h);break;case"z":i.closePath()}}n.fillStroke(this)}},Kinetic.Global.extend(Kinetic.Path,Kinetic.Shape),Kinetic.Path.getLineLength=function(n,t,i,r){return Math.sqrt((i-n)*(i-n)+(r-t)*(r-t))},Kinetic.Path.getPointOnLine=function(n,t,i,r,u,f,e){var o,s,c,a,v,y,l,h,p,w;if(f===undefined&&(f=t),e===undefined&&(e=i),o=(u-i)/(r-t+1e-8),s=Math.sqrt(n*n/(1+o*o)),r<t&&(s*=-1),c=o*s,(e-i)/(f-t+1e-8)===o)a={x:f+s,y:e+c};else{if(l=this.getLineLength(t,i,r,u),l<1e-8)return undefined;h=(f-t)*(r-t)+(e-i)*(u-i),h=h/(l*l),v=t+h*(r-t),y=i+h*(u-i),p=this.getLineLength(f,e,v,y),w=Math.sqrt(n*n-p*p),s=Math.sqrt(w*w/(1+o*o)),r<t&&(s*=-1),c=o*s,a={x:v+s,y:y+c}}return a},Kinetic.Path.getPointOnCubicBezier=function(n,t,i,r,u,f,e,o,s){function h(n){return n*n*n}function c(n){return 3*n*n*(1-n)}function l(n){return 3*n*(1-n)*(1-n)}function a(n){return(1-n)*(1-n)*(1-n)}var v=o*h(n)+f*c(n)+r*l(n)+t*a(n),y=s*h(n)+e*c(n)+u*l(n)+i*a(n);return{x:v,y:y}},Kinetic.Path.getPointOnQuadraticBezier=function(n,t,i,r,u,f,e){function o(n){return n*n}function s(n){return 2*n*(1-n)}function h(n){return(1-n)*(1-n)}var c=f*o(n)+r*s(n)+t*h(n),l=e*o(n)+u*s(n)+i*h(n);return{x:c,y:l}},Kinetic.Path.getPointOnEllipticalArc=function(n,t,i,r,u,f){var o=Math.cos(f),s=Math.sin(f),e={x:i*Math.cos(u),y:r*Math.sin(u)};return{x:n+(e.x*o-e.y*s),y:t+(e.x*s+e.y*o)}},Kinetic.Path.parsePathData=function(n){var v,p,l,s,a,t,y;if(!n)return[];for(v=n,p=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"],v=v.replace(new RegExp(" ","g"),","),l=0;l<p.length;l++)v=v.replace(new RegExp(p[l],"g"),"|"+p[l]);var it=v.split("|"),o=[],i=0,r=0;for(l=1;l<it.length;l++){for(s=it[l],a=s.charAt(0),s=s.slice(1),s=s.replace(new RegExp(",-","g"),"-"),s=s.replace(new RegExp("-","g"),",-"),s=s.replace(new RegExp("e,-","g"),"e-"),t=s.split(","),t.length>0&&t[0]===""&&t.shift(),y=0;y<t.length;y++)t[y]=parseFloat(t[y]);while(t.length>0){if(isNaN(t[0]))break;var f=null,u=[],rt=i,ut=r;switch(a){case"l":i+=t.shift(),r+=t.shift(),f="L",u.push(i,r);break;case"L":i=t.shift(),r=t.shift(),u.push(i,r);break;case"m":i+=t.shift(),r+=t.shift(),f="M",u.push(i,r),a="l";break;case"M":i=t.shift(),r=t.shift(),f="M",u.push(i,r),a="L";break;case"h":i+=t.shift(),f="L",u.push(i,r);break;case"H":i=t.shift(),f="L",u.push(i,r);break;case"v":r+=t.shift(),f="L",u.push(i,r);break;case"V":r=t.shift(),f="L",u.push(i,r);break;case"C":u.push(t.shift(),t.shift(),t.shift(),t.shift()),i=t.shift(),r=t.shift(),u.push(i,r);break;case"c":u.push(i+t.shift(),r+t.shift(),i+t.shift(),r+t.shift()),i+=t.shift(),r+=t.shift(),f="C",u.push(i,r);break;case"S":var h=i,c=r,e=o[o.length-1];e.command==="C"&&(h=i+(i-e.points[2]),c=r+(r-e.points[3])),u.push(h,c,t.shift(),t.shift()),i=t.shift(),r=t.shift(),f="C",u.push(i,r);break;case"s":var h=i,c=r,e=o[o.length-1];e.command==="C"&&(h=i+(i-e.points[2]),c=r+(r-e.points[3])),u.push(h,c,i+t.shift(),r+t.shift()),i+=t.shift(),r+=t.shift(),f="C",u.push(i,r);break;case"Q":u.push(t.shift(),t.shift()),i=t.shift(),r=t.shift(),u.push(i,r);break;case"q":u.push(i+t.shift(),r+t.shift()),i+=t.shift(),r+=t.shift(),f="Q",u.push(i,r);break;case"T":var h=i,c=r,e=o[o.length-1];e.command==="Q"&&(h=i+(i-e.points[0]),c=r+(r-e.points[1])),i=t.shift(),r=t.shift(),f="Q",u.push(h,c,i,r);break;case"t":var h=i,c=r,e=o[o.length-1];e.command==="Q"&&(h=i+(i-e.points[0]),c=r+(r-e.points[1])),i+=t.shift(),r+=t.shift(),f="Q",u.push(h,c,i,r);break;case"A":var w=t.shift(),b=t.shift(),k=t.shift(),d=t.shift(),g=t.shift(),nt=i,tt=r;i=t.shift(),r=t.shift(),f="A",u=this.convertEndpointToCenterParameterization(nt,tt,i,r,d,g,w,b,k);break;case"a":var w=t.shift(),b=t.shift(),k=t.shift(),d=t.shift(),g=t.shift(),nt=i,tt=r;i+=t.shift(),r+=t.shift(),f="A",u=this.convertEndpointToCenterParameterization(nt,tt,i,r,d,g,w,b,k)}o.push({command:f||a,points:u,start:{x:rt,y:ut},pathLength:this.calcLength(rt,ut,f||a,u)})}(a==="z"||a==="Z")&&o.push({command:"z",points:[],start:undefined,pathLength:0})}return o},Kinetic.Path.calcLength=function(n,i,r,u){var s,e,f,o=Kinetic.Path;switch(r){case"L":return o.getLineLength(n,i,u[0],u[1]);case"C":for(s=0,e=o.getPointOnCubicBezier(0,n,i,u[0],u[1],u[2],u[3],u[4],u[5]),t=.01;t<=1;t+=.01)f=o.getPointOnCubicBezier(t,n,i,u[0],u[1],u[2],u[3],u[4],u[5]),s+=o.getLineLength(e.x,e.y,f.x,f.y),e=f;return s;case"Q":for(s=0,e=o.getPointOnQuadraticBezier(0,n,i,u[0],u[1],u[2],u[3]),t=.01;t<=1;t+=.01)f=o.getPointOnQuadraticBezier(t,n,i,u[0],u[1],u[2],u[3]),s+=o.getLineLength(e.x,e.y,f.x,f.y),e=f;return s;case"A":s=0;var c=u[4],a=u[5],l=u[4]+a,h=Math.PI/180;if(Math.abs(c-l)<h&&(h=Math.abs(c-l)),e=o.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],c,0),a<0)for(t=c-h;t>l;t-=h)f=o.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],t,0),s+=o.getLineLength(e.x,e.y,f.x,f.y),e=f;else for(t=c+h;t<l;t+=h)f=o.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],t,0),s+=o.getLineLength(e.x,e.y,f.x,f.y),e=f;return f=o.getPointOnEllipticalArc(u[0],u[1],u[2],u[3],l,0),s+o.getLineLength(e.x,e.y,f.x,f.y)}return 0},Kinetic.Path.convertEndpointToCenterParameterization=function(n,t,i,r,u,f,e,o,s){var l=s*(Math.PI/180),h=Math.cos(l)*(n-i)/2+Math.sin(l)*(t-r)/2,c=-1*Math.sin(l)*(n-i)/2+Math.cos(l)*(t-r)/2,w=h*h/(e*e)+c*c/(o*o),v;w>1&&(e*=Math.sqrt(w),o*=Math.sqrt(w)),v=Math.sqrt((e*e*o*o-e*e*c*c-o*o*h*h)/(e*e*c*c+o*o*h*h)),u==f&&(v*=-1),isNaN(v)&&(v=0);var y=v*e*c/o,p=v*-o*h/e,tt=(n+i)/2+Math.cos(l)*y-Math.sin(l)*p,it=(t+r)/2+Math.sin(l)*y+Math.cos(l)*p,g=function(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])},b=function(n,t){return(n[0]*t[0]+n[1]*t[1])/(g(n)*g(t))},nt=function(n,t){return(n[0]*t[1]<n[1]*t[0]?-1:1)*Math.acos(b(n,t))},rt=nt([1,0],[(h-y)/e,(c-p)/o]),k=[(h-y)/e,(c-p)/o],d=[(-1*h-y)/e,(-1*c-p)/o],a=nt(k,d);return b(k,d)<=-1&&(a=Math.PI),b(k,d)>=1&&(a=0),f===0&&a>0&&(a=a-2*Math.PI),f==1&&a<0&&(a=a+2*Math.PI),[tt,it,e,o,rt,a,l,f]},Kinetic.Node.addGettersSetters(Kinetic.Path,["data"])}(),function(){Kinetic.TextPath=function(n){this._initTextPath(n)},Kinetic.TextPath.prototype={_initTextPath:function(n){var t,r,i,u;this.setDefaultAttrs({fontFamily:"Calibri",fontSize:12,fontStyle:"normal",text:""}),this.dummyCanvas=document.createElement("canvas"),this.dataArray=[],t=this,Kinetic.Shape.call(this,n),this.shapeType="TextPath",this._setDrawFuncs(),this.dataArray=Kinetic.Path.parsePathData(this.attrs.data);this.on("dataChange",function(){t.dataArray=Kinetic.Path.parsePathData(this.attrs.data)});for(r=["text","textStroke","textStrokeWidth"],i=0;i<r.length;i++){u=r[i];this.on(u+"Change",t._setTextData)}t._setTextData()},drawFunc:function(n){var f=this.charArr,t=n.getContext(),r,i;for(t.font=this.attrs.fontStyle+" "+this.attrs.fontSize+"pt "+this.attrs.fontFamily,t.textBaseline="middle",t.textAlign="left",t.save(),r=this.glyphInfo,i=0;i<r.length;i++){t.save();var u=r[i].p0,e=r[i].p1,o=parseFloat(this.attrs.fontSize);t.translate(u.x,u.y),t.rotate(r[i].rotation),n.fillStrokeText(this,r[i].text),t.restore()}t.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(n){Kinetic.Text.prototype.setText.call(this,n)},_getTextSize:function(n){var r=this.dummyCanvas,t=r.getContext("2d"),i;return t.save(),t.font=this.attrs.fontStyle+" "+this.attrs.fontSize+"pt "+this.attrs.fontFamily,i=t.measureText(n),t.restore(),{width:i.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var e=this,o=this._getTextSize(this.attrs.text),u;this.textWidth=o.width,this.textHeight=o.height,this.glyphInfo=[];var f=this.attrs.text.split(""),i,r,n,s=-1,t=0,c=function(){var r,n;for(t=0,r=e.dataArray,n=s+1;n<r.length;n++){if(r[n].pathLength>0)return s=n,r[n];r[n].command=="M"&&(i={x:r[n].points[0],y:r[n].points[1]})}return{}},l=function(u){var f=e._getTextSize(u).width,o=0,a=0,l,s;for(r=undefined;Math.abs(f-o)/f>.01&&a<25;){for(a++,l=o;n===undefined;)n=c(),n&&l+n.pathLength<f&&(l+=n.pathLength,n=undefined);if(n==={}||i===undefined)return undefined;s=!1;switch(n.command){case"L":Kinetic.Path.getLineLength(i.x,i.y,n.points[0],n.points[1])>f?r=Kinetic.Path.getPointOnLine(f,i.x,i.y,n.points[0],n.points[1],i.x,i.y):n=undefined;break;case"A":var y=n.points[4],h=n.points[5],v=n.points[4]+h;t===0?t=y+1e-8:f>o?t+=Math.PI/180*h/Math.abs(h):t-=Math.PI/360*h/Math.abs(h),Math.abs(t)>Math.abs(v)&&(t=v,s=!0),r=Kinetic.Path.getPointOnEllipticalArc(n.points[0],n.points[1],n.points[2],n.points[3],t,n.points[6]);break;case"C":t===0?t=f>n.pathLength?1e-8:f/n.pathLength:f>o?t+=(f-o)/n.pathLength:t-=(o-f)/n.pathLength,t>1&&(t=1,s=!0),r=Kinetic.Path.getPointOnCubicBezier(t,n.start.x,n.start.y,n.points[0],n.points[1],n.points[2],n.points[3],n.points[4],n.points[5]);break;case"Q":t===0?t=f/n.pathLength:f>o?t+=(f-o)/n.pathLength:t-=(o-f)/n.pathLength,t>1&&(t=1,s=!0),r=Kinetic.Path.getPointOnQuadraticBezier(t,n.start.x,n.start.y,n.points[0],n.points[1],n.points[2],n.points[3])}r!==undefined&&(o=Kinetic.Path.getLineLength(i.x,i.y,r.x,r.y)),s&&(s=!1,n=undefined)}};for(u=0;u<f.length;u++){if(l(f[u]),i===undefined||r===undefined)break;var a=Kinetic.Path.getLineLength(i.x,i.y,r.x,r.y),h=Kinetic.Path.getPointOnLine(0+a/2,i.x,i.y,r.x,r.y),v=Math.atan2(r.y-i.y,r.x-i.x);this.glyphInfo.push({transposeX:h.x,transposeY:h.y,text:f[u],rotation:v,p0:i,p1:r}),i=r}}},Kinetic.Global.extend(Kinetic.TextPath,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.TextPath,["fontFamily","fontSize","fontStyle"]),Kinetic.Node.addGetters(Kinetic.TextPath,["text"]),Kinetic.TextPath.prototype.fillText=Kinetic.Text.prototype.fillText,Kinetic.TextPath.prototype.strokeText=Kinetic.Text.prototype.strokeText,Kinetic.TextPath.prototype.fillStrokeText=Kinetic.Text.prototype.strokeText}();
//@ sourceMappingURL=kinetic-v4.3.1.min.js.map